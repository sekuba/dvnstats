<!DOCTYPE html>
<html
  lang="en"
  data-graphql-endpoint="http://localhost:8080/v1/graphql"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LayerZero Security Config Explorer</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="page-header">
      <div>
        <h1>LayerZero Security Config Explorer</h1>
        <p>
          utility surface for slicing the Hasura indexer at <br />
          <span class="endpoint">http://localhost:8080/v1/graphql</span>
        </p>
      </div>
      <button id="refresh-all" type="button">Refresh all</button>
    </header>

    <main>
      <section id="query-panels" aria-label="Query presets">
        <article class="query-card" data-query-key="top-oapps">
          <header class="card-header">
            <div>
              <h2>Top OApps</h2>
              <p>Ordered by total packets received.</p>
            </div>
            <button class="run-query" type="button">Run</button>
          </header>
          <form class="card-body">
            <label>
              Result limit
              <input
                name="limit"
                type="number"
                min="1"
                step="1"
                placeholder="∞"
                inputmode="numeric"
              />
            </label>
            <label>
              Minimum packet count
              <input
                name="minPackets"
                type="number"
                min="0"
                step="1"
                value="100"
                inputmode="numeric"
              />
            </label>
          </form>
          <details class="card-query">
            <summary>GraphQL query</summary>
            <pre class="graphql" data-query-code></pre>
          </details>
          <footer class="card-footer">
            <span class="status-tag" data-status>Idle</span>
          </footer>
        </article>

        <article class="query-card" data-query-key="oapp-security-config">
          <header class="card-header">
            <div>
              <h2>OApp Security Config</h2>
              <p>
                Fetch the latest merged security settings for a specific OApp.
              </p>
            </div>
            <button class="run-query" type="button">Run</button>
          </header>
          <form class="card-body">
            <label>
              OApp ID
              <input
                name="oappId"
                type="text"
                inputmode="text"
                autocomplete="off"
                spellcheck="false"
                placeholder="chainId_address"
              />
            </label>
            <p class="field-hint">
              Provide either the merged `oappId` or choose a chain and address below.
            </p>
            <label>
              Destination chain
              <input
                name="chainId"
                type="text"
                inputmode="numeric"
                autocomplete="off"
                placeholder="Select chain"
                list="oapp-chain-options"
                data-chain-input
              />
              <datalist id="oapp-chain-options" data-chain-datalist></datalist>
            </label>
            <p class="field-hint" data-chain-label>Chain not selected.</p>
            <label>
              OApp address
              <input
                name="oappAddress"
                type="text"
                inputmode="text"
                autocomplete="off"
                spellcheck="false"
                placeholder="0xabc…"
              />
            </label>
          </form>
          <details class="card-query">
            <summary>GraphQL query</summary>
            <pre class="graphql" data-query-code></pre>
          </details>
          <footer class="card-footer">
            <span class="status-tag" data-status>Idle</span>
          </footer>
        </article>

        <article class="query-card" data-query-key="popular-oapps-window">
          <header class="card-header">
            <div>
              <h2>Popular OApps (Window)</h2>
              <p>Rank OApps by packets delivered within a recent time window.</p>
            </div>
            <button class="run-query" type="button">Run</button>
          </header>
          <form class="card-body">
            <label>
              Lookback value
              <input
                name="windowValue"
                type="number"
                min="1"
                step="1"
                value="7"
                inputmode="numeric"
              />
            </label>
            <label>
              Time unit
              <select name="windowUnit">
                <option value="days" selected>Days</option>
                <option value="hours">Hours</option>
                <option value="minutes">Minutes</option>
              </select>
            </label>
            <label>
              Top results
              <input
                name="resultLimit"
                type="number"
                min="1"
                step="1"
                value="20"
                inputmode="numeric"
              />
            </label>
            <label>
              Packet sample limit
              <input
                name="fetchLimit"
                type="number"
                min="0"
                step="100"
                placeholder="∞"
                inputmode="numeric"
              />
            </label>
            <p class="field-hint">
              Sample limit bounds the packets scanned from Hasura; increase if results look truncated.
            </p>
          </form>
          <details class="card-query">
            <summary>GraphQL query</summary>
            <pre class="graphql" data-query-code></pre>
          </details>
          <footer class="card-footer">
            <span class="status-tag" data-status>Idle</span>
          </footer>
        </article>

        <article class="query-card" data-query-key="web-of-security">
          <header class="card-header">
            <div>
              <h2>Web of Security</h2>
              <p>Visualize the security graph for an OApp and its connections.</p>
            </div>
            <button class="run-query" type="button">Crawl / Load</button>
          </header>
          <form class="card-body">
            <fieldset>
              <legend>Crawl New Web</legend>
              <label>
                Seed OApp ID
                <input
                  name="seedOAppId"
                  type="text"
                  inputmode="text"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="chainId_address"
                />
              </label>
              <div class="param-grid">
                <label>
                  Depth
                  <input
                    name="depth"
                    type="number"
                    min="1"
                    max="20"
                    value="10"
                  />
                </label>
                <label>
                  Packet Limit
                  <input
                    name="limit"
                    type="number"
                    min="10"
                    max="10000"
                    value="1000"
                  />
                </label>
              </div>
            </fieldset>
            <fieldset class="field-separator">
              <legend>Or Load From File</legend>
              <label>
                Web data file
                <input
                  name="webFile"
                  type="file"
                  accept=".json"
                />
              </label>
            </fieldset>
          </form>
          <details class="card-query">
            <summary>About</summary>
            <p>
              This visualization shows the web of security connections between OApps.
              Each node represents an OApp, and edges show packet delivery paths.
              Node color/size indicates the number of required DVNs in the security config.
            </p>
          </details>
          <footer class="card-footer">
            <span class="status-tag" data-status>Idle</span>
          </footer>
        </article>
      </section>

      <section id="results" aria-live="polite">
        <header class="results-header">
          <div>
            <h2 id="results-title">Awaiting query</h2>
            <p id="results-meta">Run a query to see data.</p>
          </div>
          <button id="copy-json" type="button" disabled>Copy JSON</button>
        </header>
        <div id="results-body" class="table-container empty">
          <div class="placeholder">
            <p class="placeholder-title">No data yet</p>
            <p>Trigger a preset above to load indexer data.</p>
          </div>
        </div>
      </section>
    </main>

    <template id="error-template">
      <div class="error-banner">
        <strong>Error:</strong>
        <span data-error-message></span>
      </div>
    </template>

    <div id="alias-editor" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="alias-editor-title">
      <div class="modal-content">
        <h3 id="alias-editor-title">Set OApp Name</h3>
        <form id="alias-editor-form">
          <label>
            OApp ID
            <input name="oappId" type="text" readonly />
          </label>
          <label>
            Alias
            <input
              name="alias"
              type="text"
              autocomplete="off"
              spellcheck="false"
              placeholder="Enter a friendly name"
            />
          </label>
          <p class="modal-hint">
            Aliases are stored locally and can be exported to update <code>oapp-aliases.json</code>.
          </p>
          <div class="modal-actions">
            <button type="submit">Save</button>
            <button type="button" data-action="clear">Clear</button>
            <button type="button" data-action="export">Export JSON</button>
            <button type="button" data-action="cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
