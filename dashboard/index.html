<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LayerZero Packet Statistics</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="./stats-page.css" />
  </head>
  <body class="stats-page">
    <header class="stats-header">
      <div>
        <h1>LayerZero Packet Statistics</h1>
        <p id="stats-subtitle">Loading data...</p>
      </div>
      <nav class="header-nav">
        <a href="./explorer.html" class="nav-link">Explorer</a>
      </nav>
    </header>

    <main class="stats-main">
      <div id="loading-state" class="loading-banner">
        <p>Loading precomputed statistics...</p>
      </div>

      <div id="error-state" class="error-banner hidden">
        <strong>Error:</strong>
        <span id="error-message"></span>
      </div>

      <div id="stats-content" class="hidden">
        <!-- Overview Cards -->
        <section class="stats-grid">
          <div class="stat-card stat-card--primary">
            <h2>Total Packets</h2>
            <div class="stat-value" id="stat-total">—</div>
            <div class="stat-label">Analyzed packets</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Each packet is usually a single crosschain transaction, rarely a bundle of them</p>
            </div>
          </div>

          <div class="stat-card stat-card--highlight">
            <h2>All-Default</h2>
            <div class="stat-value" id="stat-all-default">—</div>
            <div class="stat-label">No custom security</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets validated by falling back to the standard LayerZero validation library <b>and</b> settings.</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Default Library</h2>
            <div class="stat-value" id="stat-default-lib">—</div>
            <div class="stat-label">No custom library</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets using the default smart contract (library) for validation with default or custom settings</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Tracked Library</h2>
            <div class="stat-value" id="stat-tracked">—</div>
            <div class="stat-label">Using ReceiveUln302</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets validated by a library of which we decode the validation settings (config)</p>
            </div>
          </div>


          <div class="stat-card stat-card--highlight">
            <h2>Required DVN Combinations</h2>
            <div class="stat-value" id="stat-dvn-combos">—</div>
            <div class="stat-label">Unique DVN sets by label</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Number of unique DVN contract sets used for validation in the 'required' setup</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Chains indexed</h2>
            <div class="stat-value">18</div>
            <div class="stat-label">EVM chains</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">All incoming packets and validation configs on 18 EVM chains are indexed</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Chains seen</h2>
            <div class="stat-value">138</div>
            <div class="stat-label">Unique endpoint IDs</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Unique source chains of incoming packets (with known validation settings)</p>
            </div>
          </div>
        </section>

        <!-- Jargon Explanation Cards -->
        <section class="stats-grid">
          <div class="stat-card stat-card--explain">
            <h2>Packet</h2>
            <div class="stat-explanation">A crosschain message in the LayerZero protocol. In most cases, it contains a single crosschain transaction between two OApps. Transfering a crosschain token generates a packet.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Packets contain a message payload, source EID and destination EID, source OApp address and destination OApp address</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>DVN</h2>
            <div class="stat-explanation">Decentralized Verifier Network - A single smart contract that validates packets. Each DVN defines its validation logic, but the vast majority behaves like multisigs. Can be configured by the OApp owner or LayerZero (fallback).</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">DVN is largely a misnomer, implying multiple validators where in reality there is always a single smart contract and often validation of a single entity's signature</p>
            </div>
          </div>


          <div class="stat-card stat-card--explain">
            <h2>OApp</h2>
            <div class="stat-explanation">Omnichain Application - A smart contract application capable of sending and receiving crosschain messages. Usually not owned by LayerZero, but always using the LayerZero protocol for communication.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Most OApps implement token functions. There is no restriction on what an OApp can be, it just needs to include the standard LayerZero messaging interface</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>OFT</h2>
            <div class="stat-explanation">Omnichain Fungible Token - An OApp standard that is also an ERC-20 token. Networking these tokens across chains via LayerZero allows for crosschain asset transfers.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">OFTs are the most widely used type of OApp. OFT can refer to a single token on a single chain or the abstracted set of all tokens of the same type across chains</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>EID</h2>
            <div class="stat-explanation">Endpoint ID - A unique identifier for each blockchain in the LayerZero network. Different from chain IDs but serving the same purpose.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">EIDs are needed because some blockchains use the same chain IDs (e.g. Aptos and Ethereum)</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>Validation Library</h2>
            <div class="stat-explanation">The main smart contract storing the settings for validating packets. This can be a custom contract but is almost always the default LayerZero ReceiveUln302 (Ultralight Node).</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">The library can be thought of like a panel of switches, allowing for fine-grained control over validation settings</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>ULN config</h2>
            <div class="stat-explanation">UltraLightNode config - Security settings (validation config) stored in the validation library. These settings determine which DVNs and how many source chain confirmations are required for packet validation. Settings are managed by the OApp owner or LayerZero (fallback).</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">ULN, ReceiveUln302 and library are just other words for this specialized smart contract</p>
            </div>
          </div>
        </section>

        <!-- PacketDelivered Event Flow Diagram -->
        <img src="./packetDelivered.svg" alt="PacketDelivered event flow diagram" class="svg-diagram" />

        <!-- DVN Set Threshold Distribution -->
        <section class="chart-section">
          <h2 class="chart-title">DVN Set Threshold</h2>
          <p class="chart-subtitle">Number of DVNs that <b>must</b> validate incoming packets. Combines required DVNs and optional DVN thresholds (0 and >4 grouped as "Other")</p>
          <div id="dvn-set-threshold-chart" class="pie-chart"></div>
        </section>

        <!-- Top DVN Combinations -->
        <section class="chart-section">
          <h2 class="chart-title">Top Required DVN Combinations</h2>
          <p class="chart-subtitle">Most common required DVN sets by packet count (top 20)</p>
          <div id="dvn-combo-chart" class="combo-chart"></div>
        </section>

        <!-- Time Series: Hourly Packets -->
        <section class="chart-section">
          <h2 class="chart-title">Packet Volume Over Time</h2>
          <p id="time-series-packets-subtitle" class="chart-subtitle">Hourly packet count across entire time range</p>
          <div id="time-series-packets-chart" class="time-series-chart"></div>
        </section>

        <!-- Time Series: Config Changes -->
        <section class="chart-section">
          <h2 class="chart-title">Configuration Changes Over Time</h2>
          <p id="time-series-config-subtitle" class="chart-subtitle">Hourly config changes • <span id="total-config-changes">—</span> total config changes</p>
          <div id="time-series-config-chart" class="time-series-chart"></div>
        </section>

        <!-- Chain Breakdown -->
        <section class="chart-section">
          <h2 class="chart-title">Packets by Destination Chain</h2>
          <p class="chart-subtitle">Local EID distribution</p>
          <div id="chain-chart" class="bar-chart"></div>
        </section>

        <!-- Source Chain Breakdown -->
        <section class="chart-section">
          <h2 class="chart-title">Packets by Source Chain</h2>
          <p class="chart-subtitle">Source EID distribution</p>
          <div id="src-chain-chart" class="bar-chart"></div>
        </section>

        <!-- Analysis Section -->
        <section class="chart-section">
          <h2 class="chart-title">Fragility of Scale</h2>
          <div class="analysis-text">
            <p>Since you are still here, i invite you to contemplate our motivation for building distributed systems and my motivation for building this website. Some of these systems aim to disintermediate, remove single points of failure, and enhance resilience through decentralization. LayerZero does the opposite by distributing their points of failure. Each added node or edge makes the network more fragile. The protocol fundamentally <b>cannot scale without compromising its security</b>.</p>
            <p>LayerZero is <b>by far not the only nor the worst offender among the interop protocols</b>. It is built transparently enough to allow for a monitor like this one that hints at the magnitude of risk. Many competing interop protocols do not provide this onchain transparency. But the existence of more robust, more transparent and more scalable solutions shows that interop can actually be built, and scale, well.</p>
            <p>Scroll further to get an intuition for LayerZero's Fragility of Scale.</p>
          </div>
        </section>

        <img src="./configToWeb.svg" alt="Scale of fragility diagram" class="svg-diagram" />
      </div>
    </main>

    <footer class="stats-footer">
      <p>
        Data computed from PacketDelivered records •
        <span id="computed-at">—</span> •
        <span id="time-range">—</span>
      </p>
      <p>
        Greetings go out to my boyfren, my mum and Claude Sonnet 4.5 • <a href="https://github.com/sekuba/dvnstats" target="_blank">Github</a>
      </p>
    </footer>

    <script type="module" src="./stats-page.js"></script>
  </body>
</html>
