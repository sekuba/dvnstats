<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LayerZero Packet Statistics</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="./stats-page.css" />
  </head>
  <body class="stats-page">
    <header class="stats-header">
      <div>
        <h1>LayerZero Packet Statistics</h1>
        <p id="stats-subtitle">Loading data...</p>
      </div>
      <nav class="header-nav">
        <a href="./explorer.html" class="nav-link">Explorer</a>
      </nav>
    </header>

    <main class="stats-main">
      <div id="loading-state" class="loading-banner">
        <p>Loading precomputed statistics...</p>
      </div>

      <div id="error-state" class="error-banner hidden">
        <strong>Error:</strong>
        <span id="error-message"></span>
      </div>

      <div id="stats-content" class="hidden">
        <!-- Overview Cards -->
        <section class="stats-grid">
          <div class="stat-card stat-card--primary">
            <h2>Total Packets</h2>
            <div class="stat-value" id="stat-total">—</div>
            <div class="stat-label">Analyzed packets</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Each packet is usually a single crosschain transaction, rarely a bundle of them</p>
            </div>
          </div>

          <div class="stat-card stat-card--highlight">
            <h2>All-Default</h2>
            <div class="stat-value" id="stat-all-default">—</div>
            <div class="stat-label">No custom security</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets validated by falling back to the standard LayerZero validation library and settings.</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Default Library</h2>
            <div class="stat-value" id="stat-default-lib">—</div>
            <div class="stat-label">No custom library</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets using the default smart contract (library) for validation</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Tracked Library</h2>
            <div class="stat-value" id="stat-tracked">—</div>
            <div class="stat-label">Using ReceiveUln302</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets validated by a library of which we decode the settings (config)</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Default Config</h2>
            <div class="stat-value" id="stat-default-config">—</div>
            <div class="stat-label">No custom library config</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Incoming packets using the default smart contract <b>and</b> the default settings (config)</p>
            </div>
          </div>


          <div class="stat-card stat-card--highlight">
            <h2>Required DVN Combinations</h2>
            <div class="stat-value" id="stat-dvn-combos">—</div>
            <div class="stat-label">Unique DVN sets by label</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Number of unique DVN contract sets used for validation in the 'required' setup</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Chains indexed</h2>
            <div class="stat-value">18</div>
            <div class="stat-label">EVM chains</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">All incoming packets and validation configs on 18 EVM chains are indexed</p>
            </div>
          </div>

          <div class="stat-card">
            <h2>Chains seen</h2>
            <div class="stat-value">138</div>
            <div class="stat-label">Unique endpoint IDs</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Unique source chains of incoming packets (with known validation settings)</p>
            </div>
          </div>
        </section>

        <!-- Jargon Explanation Cards -->
        <section class="stats-grid">
          <div class="stat-card stat-card--explain">
            <h2>DVN</h2>
            <div class="stat-explanation">Decentralized Verifier Network - A smart contract (often a multisig) that validates crosschain messages.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">DVNs are the security layer that confirms packets traveled correctly across chains</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>ULN Config</h2>
            <div class="stat-explanation">Ultra Light Node Configuration - Settings that define which DVNs and how many confirmations are required for packet validation.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">Each application can customize their security by choosing specific DVN sets and thresholds</p>
            </div>
          </div>

          <div class="stat-card stat-card--explain">
            <h2>Endpoint ID (EID)</h2>
            <div class="stat-explanation">Unique identifier for each blockchain in the LayerZero network. Different from chain IDs.</div>
            <div class="stat-tooltip">
              <p class="stat-tooltip-text">LayerZero uses EIDs to identify chains consistently across all networks</p>
            </div>
          </div>
        </section>

        <!-- PacketDelivered Event Flow Diagram -->
        <img src="./packetDelivered.svg" alt="PacketDelivered event flow diagram" class="svg-diagram" />

        <!-- Required DVN Count Distribution -->
        <section class="chart-section">
          <h2 class="chart-title">Required DVN Count</h2>
          <p class="chart-subtitle">'Required' DVN sets are smart contracts (often Multisigs) that <b>must</b> validate incoming packets (0 and >4 grouped as "Other")</p>
          <div id="dvn-count-chart" class="pie-chart"></div>
        </section>

        <!-- Optional DVN Count Distribution -->
        <section class="chart-section">
          <h2 class="chart-title">Optional DVN Count</h2>
          <p class="chart-subtitle">'Optional' DVN sets are smart contracts configured with a threshold of how many in the set <b>must</b> validate incoming packets (0 excluded)</p>
          <div id="optional-dvn-count-chart" class="pie-chart"></div>
        </section>

        <!-- Top DVN Combinations -->
        <section class="chart-section">
          <h2 class="chart-title">Top Required DVN Combinations</h2>
          <p class="chart-subtitle">Most common required DVN sets by packet count (top 20)</p>
          <div id="dvn-combo-chart" class="combo-chart"></div>
        </section>

        <!-- Time Series: Hourly Packets -->
        <section class="chart-section">
          <h2 class="chart-title">Packet Volume Over Time</h2>
          <p id="time-series-packets-subtitle" class="chart-subtitle">Hourly packet count across entire time range</p>
          <div id="time-series-packets-chart" class="time-series-chart"></div>
        </section>

        <!-- Time Series: Config Changes -->
        <section class="chart-section">
          <h2 class="chart-title">Configuration Changes Over Time</h2>
          <p id="time-series-config-subtitle" class="chart-subtitle">Hourly config changes • <span id="total-config-changes">—</span> total config changes</p>
          <div id="time-series-config-chart" class="time-series-chart"></div>
        </section>

        <!-- Chain Breakdown -->
        <section class="chart-section">
          <h2 class="chart-title">Packets by Destination Chain</h2>
          <p class="chart-subtitle">Local EID distribution</p>
          <div id="chain-chart" class="bar-chart"></div>
        </section>

        <!-- Source Chain Breakdown -->
        <section class="chart-section">
          <h2 class="chart-title">Packets by Source Chain</h2>
          <p class="chart-subtitle">Source EID distribution</p>
          <div id="src-chain-chart" class="bar-chart"></div>
        </section>
      </div>
    </main>

    <footer class="stats-footer">
      <p>
        Data computed from PacketDelivered records •
        <span id="computed-at">—</span> •
        <span id="time-range">—</span>
      </p>
    </footer>

    <script type="module" src="./stats-page.js"></script>
  </body>
</html>
